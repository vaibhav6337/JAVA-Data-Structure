<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Car Advisor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Bootstrap & Fonts -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    font-family: 'Poppins', sans-serif;
    color: white;
    background: #111;
    overflow-x: hidden;
    transition: 0.5s;
}

/* DARK MODE */
.dark-mode {background: #111; color: white;}
.dark-mode .sidebar {background: rgba(20,20,20,.8);}
.dark-mode .car-card {background: rgba(20,20,20,.75);}
.dark-mode .reason {background: rgba(40,40,40,.7);}
.dark-mode footer {background: rgba(20,20,20,.9);}

/* BACKGROUND SLIDER */
.bg-slider {
    position: fixed;
    top:0; left:0;
    width: 100%; height: 100%;
    z-index: -2;
    background-size: cover;
    background-position: center;
    animation: slide 20s infinite;
}
@keyframes slide {
    0% {background-image: url('https://images.unsplash.com/photo-1503376780353-7e6692767b70');}
    33% {background-image: url('https://images.unsplash.com/photo-1511919884226-fd3cad34687c');}
    66% {background-image: url('https://images.unsplash.com/photo-1549924231-f129b911e442');}
    100% {background-image: url('https://images.unsplash.com/photo-1503376780353-7e6692767b70');}
}

/* DARK OVERLAY */
.overlay {
    position: fixed;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, rgba(0,0,0,.75), rgba(0,0,0,.85));
    z-index: -1;
}

/* HEADER */
.header {
    text-align: center;
    padding: 20px;
    animation: fadeDown 1s;
}
@keyframes fadeDown {
    from {opacity:0; transform: translateY(-20px);}
    to {opacity:1; transform: translateY(0);}
}

/* SIDEBAR */
.sidebar {
    background: rgba(0,0,0,.6);
    border-radius: 15px;
    padding: 15px;
    backdrop-filter: blur(8px);
}

/* INPUTS */
label {font-size: 12px; color: #ccc;}
.form-control {
    background: #000000aa;
    border: 1px solid #444;
    color: white;
}
.form-control:focus {
    background: #000000dd;
    border-color: #00d2ff;
    box-shadow: none;
}

/* BUTTON */
.btn-main {
    background: linear-gradient(135deg,#00d2ff,#3a7bd5);
    border: none;
    font-weight: 600;
}

/* CAR CARD */
.car-card {
    position: relative;
    background: rgba(0,0,0,.65);
    border-radius: 15px;
    overflow: hidden;
    transition: .5s;
    box-shadow: 0 15px 30px rgba(0,0,0,.7);
}
.car-card:hover {
    transform: scale(1.08) translateY(-8px);
    box-shadow: 0 25px 50px rgba(0,0,0,.9);
}
.car-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    display: block;
    border-bottom: 2px solid #00d2ff33;
    transition: transform 0.5s;
}
.car-card:hover img {
    transform: scale(1.05);
}
/* SHINE EFFECT */
.car-card::before {
    content: '';
    position: absolute;
    top:0; left: -75%;
    width: 50%; height: 100%;
    background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.25) 50%, rgba(255,255,255,0) 100%);
    transform: skewX(-25deg);
    transition: 0.5s;
}
.car-card:hover::before {
    left: 125%;
}

/* STATUS */
.green {border-left: 5px solid #00ff99;}
.yellow {border-left: 5px solid #ffc107;}
.red {border-left: 5px solid #ff4d4d;}

.reason {
    background: #00000099;
    padding: 6px;
    border-radius: 6px;
    font-size: 12px;
    color: #ccc;
}

/* ACTION BAR */
.action-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
}

/* DARK MODE TOGGLE */
#darkToggle {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #00d2ff;
    border: none;
    color: white;
    padding: 10px 14px;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(0,0,0,.3);
    z-index: 9999;
    transition: 0.3s;
}
#darkToggle:hover {transform: scale(1.1);}

/* FOOTER */
footer {
    background: rgba(24,40,72,.9);
    text-align: center;
    padding: 20px;
    margin-top: 40px;
    border-radius: 10px;
}
footer a {color: white; margin: 0 10px; transition: 0.3s;}
footer a:hover {color: #00d2ff; text-decoration: none;}
</style>
</head>
<body>

<div class="bg-slider"></div>
<div class="overlay"></div>

<!-- DARK MODE BUTTON -->
<button id="darkToggle" onclick="toggleDarkMode()">ðŸŒ™</button>

<div class="container-fluid" style="padding-top:40px;">
    <div class="header">
        <h2>ðŸš˜ Smart Car Advisor</h2>
        <p>AI Powered Premium Recommendation System</p>
    </div>

    <div class="row">
        <!-- FORM -->
        <div class="col-md-3 mb-4">
            <div class="sidebar">
                <form method="POST">
                    <label for="price">Budget (Lakhs)</label>
                    <input id="price" name="price" type="number" class="form-control form-control-sm mb-2" required>

                    <label for="mileage">Mileage (km/l)</label>
                    <input id="mileage" name="mileage" type="number" class="form-control form-control-sm mb-2" required>

                    <label for="fuel">Fuel Type</label>
                    <select id="fuel" name="fuel" class="form-control form-control-sm mb-2" required>
                        <option value="">Select</option>
                        <option>Petrol</option>
                        <option>Diesel</option>
                    </select>

                    <label for="seating">Seats</label>
                    <input id="seating" name="seating" type="number" class="form-control form-control-sm mb-3" required>

                    <button class="btn btn-main btn-sm btn-block">Get Recommendations</button>
                </form>
            </div>
        </div>

        <!-- RESULTS -->
        <div class="col-md-9">
        {% if tables is not none %}
            <div class="mb-2 action-bar">
                <div>
                    <button onclick="sortPrice()" class="btn btn-sm btn-outline-info">Sort Price</button>
                    <button onclick="sortMileage()" class="btn btn-sm btn-outline-success">Sort Mileage</button>
                </div>
                <button onclick="compareCars()" class="btn btn-sm btn-outline-warning">Compare</button>
            </div>

            <div id="cards" class="row">
            {% for row in tables.itertuples() %}
                <div class="col-md-4 mb-3 car-card
                    {% if price is not none and row.price_lakh <= price %}green
                    {% elif row.price_lakh <= price*1.2 %}yellow
                    {% else %}red{% endif %}"
                    data-price="{{ row.price_lakh }}"
                    data-mileage="{{ row.mileage }}">

                    <!-- Dynamic car image -->
                    <img src="https://source.unsplash.com/600x400/?{{ row.car_name | replace(' ', '-') }},car">

                    <div class="p-2 d-flex align-items-center">
                        <input type="checkbox" class="cmp mr-2"> 
                        <!-- Brand logo placeholder -->
                        <img src="https://logo.clearbit.com/{{ row.car_name.split(' ')[0] | lower }}.com" style="width:24px;height:24px;margin-right:5px;">
                        <strong>{{ row.car_name }}</strong>
                    </div>
                    <div class="p-2">
                        <p style="font-size:12px;margin:0;">â‚¹ {{ row.price_lakh }} L | {{ row.mileage }} km/l</p>
                        <p style="font-size:12px;margin:0;">Fuel: {% if row.fuel_type==0 %}Petrol{% else %}Diesel{% endif %}</p>
                        <div class="reason">ðŸ¤– {{ row.Reason }}</div>
                    </div>
                </div>
            {% endfor %}
            </div>

            <canvas id="chart" class="mt-3"></canvas>
        {% endif %}
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer>
    <p>ðŸš€ Developed by Vaib's</p>
    <p>
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-linkedin-in"></i></a>
        <a href="mailto:vaibs.ai@gmail.com"><i class="fas fa-envelope"></i></a>
    </p>
</footer>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const cardsContainer = document.getElementById("cards");

function sortPrice(){
    let c = [...document.getElementsByClassName("car-card")];
    c.sort((a,b) => a.dataset.price - b.dataset.price);
    c.forEach(x => cardsContainer.appendChild(x));
}

function sortMileage(){
    let c = [...document.getElementsByClassName("car-card")];
    c.sort((a,b) => b.dataset.mileage - a.dataset.mileage);
    c.forEach(x => cardsContainer.appendChild(x));
}

let chartInstance = null;
function compareCars(){
    let selected = document.querySelectorAll(".cmp:checked");
    if(selected.length != 2){ alert("Select exactly 2 cars"); return; }

    let a = selected[0].closest(".car-card");
    let b = selected[1].closest(".car-card");

    const labels = [
        a.querySelector("strong").innerText,
        b.querySelector("strong").innerText
    ];
    const dataPrice = [a.dataset.price, b.dataset.price];
    const dataMileage = [a.dataset.mileage, b.dataset.mileage];

    const config = {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: "Price (Lakhs)",
                    data: dataPrice,
                    backgroundColor: ['rgba(0,210,255,0.7)','rgba(0,210,255,0.7)'],
                    borderRadius: 10
                },
                {
                    label: "Mileage (km/l)",
                    data: dataMileage,
                    backgroundColor: ['rgba(58,123,213,0.7)','rgba(58,123,213,0.7)'],
                    borderRadius: 10
                }
            ]
        },
        options: {
            responsive: true,
            animation: {duration: 1000, easing: 'easeOutQuart'},
            plugins: {legend: {position: 'top'}, tooltip: {mode: 'index', intersect: false}},
            scales: {y: {beginAtZero:true, grid:{color:'#444'}}, x: {grid:{color:'#333'}}}
        }
    };

    if(chartInstance) chartInstance.destroy();
    chartInstance = new Chart(document.getElementById("chart"), config);
}

function toggleDarkMode(){
    document.body.classList.toggle("dark-mode");
}
</script>

</body>
</html>
